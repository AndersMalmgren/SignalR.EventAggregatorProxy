(function(d,a){d.EventAggregator=function(e){this.constraintId=0;if(e){this.proxy=new c(this);}};d.EventAggregator.prototype=function(){function j(o,n){o=b(o);var m=n?o.constructor:o;if(m.__subscribers===undefined){m.__subscribers=[];}return m.__subscribers;}function i(m,n){if(m==null){return true;}if(m.length!==n.length){return false;}for(var o=0;o<n.length;o++){if(m[o]!==n[o]){return false;}}return true;}function f(n,m){return m==null||(n.constraintId===m);}function h(m,n){return i(m.type.genericArguments,n.type.genericArguments)&&f(m,n.constraintId);}function g(m,n){if(n===undefined){return false;}for(var p in m){var q=m[p];var r=n[p];var o=typeof q==="object";if(q!==r&&!o){return false;}if(o&&!g(q,r)){return false;}}return true;}function k(m){if(m.__getSubscriptions===undefined){var n=[];m.__getSubscriptions=function(){return n;};}return m.__getSubscriptions();}function l(m){var o=j(m.type,false);if(b(m.type).proxyEvent!==true){return false;}if(o.length===0){return true;}if(m.type.genericArguments==null&&m.constraint==null){return false;}var n=true;a.each(o,function(){if(m.type.genericArguments!=null&&!i(m.type.genericArguments,this.type.genericArguments)){return true;}if(m.constraint!=null&&!g(m.constraint,this.constraint)){return true;}n=false;m.constraintId=this.constraintId;return false;});return n;}function e(m){m.constraintId=m.constraint?this.constraintId++:null;}return{unsubscribe:function(n){if(n.__getSubscriptions===undefined){return;}var o=n.__getSubscriptions();var m=[];a.each(o,function(){var r=-1;var t=b(this.type).__subscribers;for(var q=0;q<t.length;q++){if(t[q].context==n&&h(this,t[q])){r=q;break;}}if(r!=-1){var u=t.splice(r,1)[0];var p=false;for(var s=0;s<t.length;s++){if(h(u,t[s])){p=true;break;}}if(!p){m.push(u);}}});if(this.proxy){this.proxy.unsubscribe(m);}},subscribe:function(t,o,n,m){var s=k(n);var q=j(t,false);var r={type:t,handler:o,context:n,constraint:m};var p=l.call(this,r);s.push(r);q.push(r);if(this.proxy&&p){e.call(this,r);this.proxy.subscribe(b(t),t.genericArguments,m,r.constraintId);}},publish:function(o,n,m){var p=j.call(this,o,true);a.each(p,function(){if(i(this.type.genericArguments,n)&&f(this,m)){this.handler.call(this.context,o);}});}};}();var c=function(e){this.eventAggregator=e;this.hub=a.connection.eventAggregatorProxyHub;this.hub.client.onEvent=this.onEvent.bind(this);this.queueSubscriptions=true;this.queuedSubscriptions=[];a.connection.hub.start().done(this.sendSubscribeQueue.bind(this));};c.prototype={onEvent:function(g){var h=d.getEvent(g.type);var e=new h();for(var f in g.event){e[f]=g.event[f];}this.eventAggregator.publish(e,g.genericArguments,g.id);},subscribe:function(g,h,e,f){if(g.proxyEvent!==true){return;}this.queuedSubscriptions.push({type:g.type,genericArguments:h,constraint:e,constraintId:f});if(!this.queueSubscriptions){clearTimeout(this.throttleTimer);this.throttleTimer=setTimeout(this.sendSubscribeQueue.bind(this),1);}},unsubscribe:function(e){var f=a.map(e,function(h){var g=b(h.type);if(g.proxyEvent!==true){return null;}return{type:g.type,genericArguments:h.type.genericArguments,id:h.constraintId};});if(f.length>0){this.queueSubscriptions=true;this.hub.server.unsubscribe(f).done(this.sendSubscribeQueue.bind(this));}},sendSubscribeQueue:function(){this.queueSubscriptions=false;if(this.queuedSubscriptions.length===0){return;}var e=this.queuedSubscriptions;this.queuedSubscriptions=[];this.hub.server.subscribe(e);}};function b(e){return e.genericConstructor||e;}d.eventAggregator=new d.EventAggregator(true);})(window.signalR=window.signalR||{},jQuery);