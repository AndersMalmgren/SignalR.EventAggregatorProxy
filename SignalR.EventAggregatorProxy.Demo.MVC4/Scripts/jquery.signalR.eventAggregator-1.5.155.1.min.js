(function(e,a){e.EventAggregator=function(f){this.constraintId=0;if(f){this.proxy=new d(this);}};e.EventAggregator.prototype=function(){function j(o,n){o=c(o);var m=n?o.constructor:o;if(m.__subscribers===undefined){m.__subscribers=[];}return m.__subscribers;}function g(n,m){return m==null||(n.constraintId===m);}function i(m,n){return b(m.type.genericArguments,n.type.genericArguments)&&g(m,n.constraintId);}function h(m,n){if(n===undefined){return false;}for(var p in m){var q=m[p];var r=n[p];var o=typeof q==="object";if(q!==r&&!o){return false;}if(o&&!h(q,r)){return false;}}return true;}function k(m){if(m.__getSubscriptions===undefined){var n=[];m.__getSubscriptions=function(){return n;};}return m.__getSubscriptions();}function l(m){var o=j(m.type,false);if(c(m.type).proxyEvent!==true){return false;}if(o.length===0){return true;}if(m.type.genericArguments==null&&m.constraint==null){return false;}var n=true;a.each(o,function(){if(m.type.genericArguments!=null&&!b(m.type.genericArguments,this.type.genericArguments)){return true;}if(m.constraint!=null&&!h(m.constraint,this.constraint)){return true;}n=false;m.constraintId=this.constraintId;return false;});return n;}function f(m){m.constraintId=m.constraint?this.constraintId++:null;}return{unsubscribe:function(n){if(n.__getSubscriptions===undefined){return;}var o=n.__getSubscriptions();var m=[];a.each(o,function(){var r=-1;var t=c(this.type).__subscribers;for(var q=0;q<t.length;q++){if(t[q].context==n&&i(this,t[q])){r=q;break;}}if(r!=-1){var u=t.splice(r,1)[0];var p=false;for(var s=0;s<t.length;s++){if(i(u,t[s])){p=true;break;}}if(!p){m.push(u);}}});if(this.proxy){this.proxy.unsubscribe(m);}},subscribe:function(t,o,n,m){var s=k(n);var q=j(t,false);var r={type:t,handler:o,context:n,constraint:m};var p=l.call(this,r);s.push(r);q.push(r);if(this.proxy&&p){f.call(this,r);this.proxy.subscribe(c(t),t.genericArguments,m,r.constraintId);}},publish:function(o,n,m){var p=j.call(this,o,true);a.each(p,function(){if(b(this.type.genericArguments,n)&&g(this,m)){this.handler.call(this.context,o);}});}};}();var d=function(f){this.eventAggregator=f;if(a.connection.eventAggregatorProxyHub==null){throw"Hub with Id 'eventAggregatorProxyHub' is missing. Ensure that '/signalr/hubs' is referenced before the event aggregator client.";}this.hub=a.connection.eventAggregatorProxyHub;this.hub.client.onEvent=this.onEvent.bind(this);this.queueSubscriptions=true;this.isConnected=false;this.queuedSubscriptions=[];this.activeSubscriptions=[];a.connection.hub.reconnected(this.reconnected.bind(this));a.connection.hub.disconnected(this.start.bind(this));this.start();};d.prototype={start:function(){a.connection.hub.start().done(this.isConnected?this.reconnected.bind(this):this.sendSubscribeQueue.bind(this));},onEvent:function(h){var i=e.getEvent(h.type);var f=new i();for(var g in h.event){f[g]=h.event[g];}this.eventAggregator.publish(f,h.genericArguments,h.id);},subscribe:function(h,i,f,g){if(h.proxyEvent!==true){return;}this.queuedSubscriptions.push({type:h.type,genericArguments:i,constraint:f,constraintId:g});if(!this.queueSubscriptions){clearTimeout(this.throttleTimer);this.throttleTimer=setTimeout(this.sendSubscribeQueue.bind(this),1);}},unsubscribe:function(f){var g=a.map(f,function(i){var h=c(i.type);if(h.proxyEvent!==true){return null;}return this.removeActiveSubscription({type:h.type,genericArguments:i.type.genericArguments,id:i.constraintId});}.bind(this));if(g.length>0){this.queueSubscriptions=true;this.hub.server.unsubscribe(g).done(this.sendSubscribeQueue.bind(this));}},removeActiveSubscription:function(h){for(var g=0;g<this.activeSubscriptions.length;g++){var f=this.activeSubscriptions[g];if(f.type===h.type&&b(f.genericArguments,h.genericArguments)&&f.constraintId===h.id){this.activeSubscriptions.splice(g,1);break;}}return h;},sendSubscribeQueue:function(f){var g=typeof(f)==="boolean"?f:false;this.isConnected=true;this.queueSubscriptions=false;if(this.queuedSubscriptions.length===0){return;}var h=this.queuedSubscriptions;this.queuedSubscriptions=[];this.pushRange(this.activeSubscriptions,h);this.hub.server.subscribe(h,g);},pushRange:function(f,g){f.push.apply(f,g);},reconnected:function(){var f=this.activeSubscriptions;this.activeSubscriptions=[];this.queuedSubscriptions=f;this.sendSubscribeQueue(true);}};function c(f){return f.genericConstructor||f;}function b(f,g){if(f==null){return true;}if(f.length!==g.length){return false;}for(var h=0;h<g.length;h++){if(f[h]!==g[h]){return false;}}return true;}e.eventAggregator=new e.EventAggregator(true);})(window.signalR=window.signalR||{},jQuery);